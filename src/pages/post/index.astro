---
import { getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";

const posts = await getCollection("post", ({ data }) => {
  return data.status === "published";
});

// Sort by date, newest first
const sortedPosts = posts.sort((a, b) => {
  const dateA = a.data.date || new Date(0);
  const dateB = b.data.date || new Date(0);
  return dateB.getTime() - dateA.getTime();
});
---

<Layout title="Posts">
  <main>
    <h1>Posts</h1>
    <div class="post-list">
      {sortedPosts.map((post) => (
        <article class="post-preview">
          <h2><a href={`/post/${post.slug}`}>{post.data.title}</a></h2>
          <p>{post.data.subtitle}</p>
          {post.data.date && (
            <time datetime={post.data.date.toISOString()}>
              {post.data.date.toLocaleDateString()}
            </time>
          )}
        </article>
      ))}
    </div>
  </main>
</Layout>

<style>
  .post-list {
    display: flex;
    flex-direction: column;
    gap: 2rem;
  }
  
  .post-preview h2 a {
    text-decoration: none;
    color: inherit;
  }
  
  .post-preview h2 a:hover {
    text-decoration: underline;
  }
  
  .post-preview time {
    color: #666;
    font-size: 0.9em;
  }
</style>