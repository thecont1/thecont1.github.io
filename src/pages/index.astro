---
import SiteHeader from "../components/SiteHeader.astro";
import SiteFooter from "../components/SiteFooter.astro";
import HomeHero from "../components/home/HomeHero.astro";
import "../styles/home.css";
import { getCollection } from "astro:content";
import { existsSync } from "node:fs";
import path from "node:path";
import { fileURLToPath } from "node:url";

const photography = await getCollection("photography", ({ data }) => data.status === "published");
const writing = await getCollection("writing", ({ data }) => data.status === "published");
const datascience = await getCollection("datascience", ({ data }) => data.status === "published");

const normalizePublicPath = (p?: string) => (p ? p.replace(/^\/public\//, "/") : p);

const publicDir = fileURLToPath(new URL("../../public/", import.meta.url));
const hasPublicFile = (p?: string) => {
  if (!p) return false;
  const rel = p.replace(/^\/+/, "");
  return existsSync(path.join(publicDir, rel));
};
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Mahesh Shantaram | visual artist, data scientist</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fraunces:opsz,wght@9..144,400;9..144,600&family=Inter:wght@400;500;600&family=DM+Sans:wght@500;600&family=Lexend:wght@300;400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
  </head>

  <body>
    <canvas id="snow-canvas" aria-hidden="true"></canvas>
    <!-- Persistent navigation -->
    <SiteHeader />

    <main>
      <!-- ===================================== -->
      <!-- HERO: carousel + curtain -->
      <!-- ===================================== -->
      <HomeHero />

      <!-- Creates space for curtain lift -->
      <div class="scroll-runway"></div>

      <!-- Small pause before projects take over -->
      <div class="scroll-buffer"></div>

      <!-- ===================================== -->
      <!-- PROJECTS -->
      <!-- ===================================== -->
      <section id="projects" class="projects">
        <header class="projects-header">
          <h1 class="projects-title">The Projects</h1>
        </header>

        <!-- PHOTOGRAPHY -->
        <div class="projects-section">
          <div class="projects-label">Photography</div>
          <div class="projects-row">
            {photography.map((post) => (
              <article class="project-card image-card">
                <a href={`/photography/${post.slug}`}>
                  <div class="card-media">
                    {(() => {
                      const heroSrc = normalizePublicPath(post.data.heroImage);
                      return heroSrc && hasPublicFile(heroSrc) ? (
                        <img src={heroSrc} alt={post.data.title} />
                      ) : (
                        <svg viewBox="0 0 4 3" class="card-placeholder" aria-hidden="true">
                          <rect x="0" y="0" width="4" height="3" />
                        </svg>
                      );
                    })()}
                  </div>
                  <h3>{post.data.title}</h3>
                  <p>{post.data.excerpt}</p>
                  <span class="read-more">Read More →</span>
                </a>
              </article>
            ))}
          </div>
        </div>

        <!-- WRITING -->
        <div class="projects-section">
          <div class="projects-label">Writing</div>
          <div class="projects-row">
            {writing.map((post) => (
              <article class="project-card text-card">
                <a href={`/writing/${post.slug}`}>
                  <h3>{post.data.title}</h3>
                  <p>{post.data.excerpt}</p>
                  <span class="read-more">Read More →</span>
                </a>
              </article>
            ))}
          </div>
        </div>

      </section>

      <!-- ===================================== -->
      <!-- ABOUT ME -->
      <!-- ===================================== -->
      <section id="about" class="about-section">
        <header class="projects-header">
          <h2 class="projects-title">About Me</h2>
        </header>

        <div class="about-container">
          <div class="about-text">
            <p class="lead"><strong>Mahesh Shantaram</strong> <br><i>Documentary Photographer. <br>Visual Artist. <br>Data Scientist. <br>Bangalore, India.</i></p>
            <p>I'm Mahesh Shantaram, independent photographer based in Bangalore, India. I use personal and subjective documentary photo series to study complex systems, societies, and institutions, particularly with reference to contemporary India.</p>
            <p>Everything that's great about India and everything that's wrong with it can be summarised by a single wedding. <a href="/photography/matrimania">Matrimania</a>, six years in the making, is a fictional photo series about society seen through the prism of India's wedding culture. Matrimania was seen at photo festivals around the world, such as Photoquai 2011, PhotoPhnomPenh 2012, Delhi Photo Festival 2013, Addis Photo Festival 2014, Chobi Mela 2015, and Angkor Photo Festival 2015.</p>
            <p>I'm often seen rubbing shoulders with politicians. This is necessitated by the project <a href="/photography/lastdays">Last Days of Manmohan</a> that was born during the tumultuous days leading into India's hotly contested general elections of 2014. (Mis)using the tools of news photojournalism to document political culture in India, I offer a window into the theatre of Indian-style politics and its state actors.</p>
            <p>My latest obsession in 2016 concerns <a href="/photography/africans">racism in India</a>. I look at this difficult subject through anecdotes and stories of black Africans living in India. This is the realisation of a long-held dream to work on a pure portrait project.</p>
            <p>Circumstances once forced me to <a href="http://thecontrarian.in/blog/2007/bangalore_loves_volvo.php" target="_blank" rel="noopener noreferrer">steer a Volvo bus to safety</a>. I've also flown a plane after downing six pints of Guinness the previous night (this is not recommended). My personal goal for <strike>2010</strike> <strike>2011</strike> <strike>2012</strike> <strike>2014</strike> the near future is to learn to drive a car.</p>
            <p>After a degree in Computer Electronics, I went on to offset the error with a diploma in photography from Paris. I moved back to Bangalore in 2006 and have been an independent photographer ever since.</p>
            
            <div class="about-links">
               <a href="/about/cv_MaheshShantaram.pdf" class="btn-text" target="_blank">View Resume →</a>
            </div>
          </div>

          <div class="about-scroll-wrapper">
            <div class="about-images">
              <figure class="about-card">
                <img src="/assets/ms1.jpg" alt="Portrait by my 3 year-old niece" />
                <figcaption>Portrait by my 3 year-old niece when I was teaching her how to make a portrait. San Jose, 2013.</figcaption>
              </figure>
              <figure class="about-card">
                <img src="/assets/ms2.jpg" alt="Photoquai, Paris, 2011" />
                <figcaption>My profound explanation causes the Culture Minister to instantly spin into a deep meditative state whereupon he ponders the meaning of life; Photoquai, Paris, 2011.</figcaption>
              </figure>
              <figure class="about-card">
                <img src="/assets/ms3.jpg" alt="First days. Navi Mumbai, 2000" />
                <figcaption>First days. Navi Mumbai, 2000.</figcaption>
              </figure>
            </div>
          </div>
        </div>
      </section>

      <!-- ===================================== -->
      <!-- CONTACT -->
      <!-- ===================================== -->
      <section id="contact" class="contact-section">
        <header class="projects-header">
          <h2 class="projects-title">Contact</h2>
        </header>
        
        <div class="contact-grid">
          <div class="whatsapp-box">
            <h3>Start a Conversation over WhatsApp</h3>
            <p class="wa-label">Type a message below and hit send to open a chat with me.</p>
            <form id="wa-form" class="wa-form">
              <textarea id="wa-message" rows="7" placeholder="Hey Mahesh, about that 500 bucks I owe you..."></textarea>
              <button type="submit" class="wa-btn">
                Send to WhatsApp
                <svg viewBox="0 0 24 24" width="18" height="18" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M22 2L11 13" />
                  <path d="M22 2L15 22L11 13L2 9L22 2Z" />
                </svg>
              </button>
            </form>
          </div>

          <div class="contact-info">
            <p class="contact-intro">Get in touch to say hello.</p>
            <a href="mailto:ms@thecontrarian.in" class="email-link">ms@thecontrarian.in</a>
          </div>

        </div>
      </section>

      <!-- ===================================== -->
      <!-- FOOTER -->
      <!-- ===================================== -->
      <SiteFooter />
    </main>
    <script src="/textmode.js" defer></script>
    <script src="/curtain-scroll-fallback.js" defer></script>
    <script src="/snow.js" defer></script>
    <script>
      // WhatsApp Form Handler
      const form = document.getElementById('wa-form');
      const messageInput = document.getElementById('wa-message');
      const PHONE_NUMBER = "919980129770";

      if (form && messageInput) {
        form.addEventListener('submit', (e) => {
          e.preventDefault();
          const text = encodeURIComponent(messageInput.value);
          if (!text) return;
          
          const url = `https://wa.me/${PHONE_NUMBER}?text=${text}`;
          window.open(url, '_blank');
        });
      }
    </script>
  </body>
</html>
